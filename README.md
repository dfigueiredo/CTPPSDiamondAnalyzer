<b>Installation, CMSSW_9_2_X</b>

```
cmsrel CMSSW_9_2_6
cd CMSSW_9_2_6/src
cmsenv
git cms-init
git cms-merge-topic CTPPS:diamond_unpacker_afterTS1_2017
git cms-addpkg EventFilter/CTPPSRawToDigi
git cms-addpkg CondFormats/CTPPSReadoutObjects
cd CondFormats/CTPPSReadoutObjects/xml
wget -q -N https://raw.githubusercontent.com/cms-sw/cmssw/master/CondFormats/CTPPSReadoutObjects/xml/mapping_timing_diamond_2017.xml
cd $CMSSW_BASE/src
git clone https://github.com/dfigueiredo/CTPPSDiamondAnalyzer.git
scram b -j 8
```


<b>Installation, CMSSW_9_4_X</b>

```
cmsrel CMSSW_9_4_0_pre2
cd CMSSW_9_4_0_pre2/src
cmsenv
git clone https://github.com/dfigueiredo/CTPPSDiamondAnalyzer.git
scram b -j 8
```

<b>Options</b>

The offline monitor tool works for dat, RAW and RECO dataformats (data_type options "RECO", "RAW" or "dat"). Moreover, you can run it locally (or lxbatch) and also in CMS Crab.
In case you run over crab, you must set "reducedPlots = 0" since this option does not produce automatic image plots for all the channels (as a ntuple containing mean/sigma results per sensor).

<b>Setting to run locally (or lxbatch)</b>

Edit a python script to generate a list of files from a specific path (i.e RunXXXYYY).

i.e: /store/t0streamer/Data/PhysicsCommissioning/000/XXX/YYY/ (t0streamer for the Physics Commissioning streamer)
i.e: /store/t0streamer/Minidaq/A/000/XXX/YYY (Minidaq)

```
cd $CMSSW_BASE/src/CTPPSDiamondAnalyzer/Skimmer/test
python generateFiles.py (it will generate the file python/AutoGenerate_cff.py that includes the list of files from the path you have specified)
```

<b>Finding Files: dat, RAW or RECO</b>

Firstly, in order to find the list of files for a given run, you need to open CMS-DAS (https://cmsweb.cern.ch/das/), and search "dataset run=XXXYYY". After that, a list of samples will appear. Choose the sample that contains the name "ZeroBias" (or another Primary dataset you prefer) and "RAW" or "RECO". Finally, for instance, do a search "files dataset=/ZeroBias/RunXXXYYY/RAW", selecting "list plain option" in the website gui. Copy the list of the files for the run you would like to use in the file RunXXXYYY_cff.py (or any other name) keeping the format as AutoGenerated_cff.py. Load this file in RunMonitor.py

Another option to search on DAS, is to use the script "das_client.py".

First search the sample:

```
./das_client.py --query="dataset=/ZeroBias/Run2017E-*/RAW" --format=plain --limit=0
```

And after search files for a specific run (i.e. 304447):

```
./das_client.py --query="file dataset=/ZeroBias/Run2017E-v1/RAW" --format=plain --limit=0 | grep 304/447
```

<b>Configuring Running Script</b>

Before run, you need to configure some parameters in RunMonitor.py: set the fit range for all the plots (for instance, choosing a time window from 0 to 125 ns), the run you would like to process or the BX you would like to select the events. If the range of the fit is not well specified, the fits results sometimes do not work since you are selecting the wrong leading/trailing edge peak. Always check the fit in the Leading or Trailing Edge distributions to be sure the tool selected the right time window. Options "RunNumber" and "reducedPlots" are mandatory.

```
    bx = cms.untracked.vint32(), #empty vector: no BX selection. You can select a specific BX.
    RunNumber = cms.untracked.string("300466"),
    # If ufirstHisto == ulastHisto or ( ufirstHisto < 0 || ulastHisto < 0); fit maximum peak from 0 to 125 ns.
    ufirstHisto = cms.double(0), # min X histo, (fit and plot draw). 
    ulastHisto = cms.double(125) # max X histo, (fit and plot draw).
    reducedPlots = cms.untracked.uint32(0) # > 0, generates image plots automatically. #If 2, produce extra plots leading/trailing vs ToT per channel.
```



<b>Running Example</b>

First step is to set your grid proxy to be able to access files on grid (or eos):

```
voms-proxy-init --voms cms
```

Execute CMSSW:

```
cmsRun CTPPSDiamondAnalyzer/Skimmer/test/RunMonitor.py Run=304447 Type=RECO (Options, Type=RECO,RAW or DAT)
```

However, if you would like to submit in lxbatch jobs, configure runJobs.csh and edit for your case. After, do:

```
./sendJob.sh (outputs will be saved on $CMSSW_BASE/src/CTPPSDiamondAnalyzer/Skimmer/test)
```

<b>Grid Submission</b>

In order to run on grid, reducedPlots option must be set 0. Please, edit crab script accordinly.
Or, you can use multicrab tool.

```
/multiCRAB.py
```

<b>Copy the Plots to your Private DNS folder in lxplus:</b>

```
cp -r RunXXXYYY /afs/cern.ch/user/U/$USER/public/html/. (or www)
For instance /afs/cern.ch/user/d/dmf/public/html
```

This is accessible from http://cmsdoc.cern.ch/~$USER

In case this does not work, you can create a website on web.cern.ch and point your DNS to a EOS folder. Check cernbox instructions to set a webpage.
